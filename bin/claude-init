#!/bin/bash

# claude-init - Initialize a new project from ~/.claude/project-template
# Usage: mkdir my-project && cd my-project && claude-init

set -e

TEMPLATE_DIR="$HOME/.claude/project-template"
TARGET_DIR="${1:-.}"

# Colors
GREEN='\033[0;32m'
BLUE='\033[0;34m'
YELLOW='\033[1;33m'
NC='\033[0m'

log() {
    echo -e "${BLUE}[claude-init]${NC} $1"
}

success() {
    echo -e "${GREEN}[claude-init]${NC} $1"
}

warn() {
    echo -e "${YELLOW}[claude-init]${NC} $1"
}

# Check if template exists
if [ ! -d "$TEMPLATE_DIR" ]; then
    echo "Error: Template not found at $TEMPLATE_DIR"
    echo "Create the template first or check your ~/.claude/ setup."
    exit 1
fi

# Check if already initialized
if [ -f "$TARGET_DIR/CLAUDE.md" ]; then
    warn "Project already initialized (CLAUDE.md exists)"
    read -p "Overwrite? (yes/no): " response
    if [ "$response" != "yes" ] && [ "$response" != "y" ]; then
        echo "Aborted."
        exit 0
    fi
fi

log "Initializing project from template..."

# Copy template files
cp "$TEMPLATE_DIR/CLAUDE.md" "$TARGET_DIR/"
cp "$TEMPLATE_DIR/LEARNINGS.md" "$TARGET_DIR/"
cp "$TEMPLATE_DIR/PROJECT_SCOPE.md" "$TARGET_DIR/"

# Create directories
mkdir -p "$TARGET_DIR/TASKS"
mkdir -p "$TARGET_DIR/ERRORS"

# Copy task template
if [ -f "$TEMPLATE_DIR/TASKS/TASK_TEMPLATE.md" ]; then
    cp "$TEMPLATE_DIR/TASKS/TASK_TEMPLATE.md" "$TARGET_DIR/TASKS/"
fi

success "Project initialized!"
echo ""
echo "Created:"
echo "  - CLAUDE.md"
echo "  - LEARNINGS.md"
echo "  - PROJECT_SCOPE.md"
echo "  - TASKS/"
echo "  - ERRORS/"
echo ""
echo "Next steps:"
echo "  1. Run: claude"
echo "  2. Use: /kickoff"
echo "  3. Brain dump your idea"
echo ""
